var fpath = "/Users/mht/Documents/research/polgrice/experiment/data_analysis/data/"

var semData = mht.readCSV(fpath+"literalSemantics.csv").data
var df_semantics = dataFrame(semData.slice(0,semData.length-1), ["state", "judgment"])

var allStates = _.uniq(_.pluck(df_semantics,"state"))
var allUtterances = _.uniq(_.pluck(df_semantics,"utterance"))


// var semanticsBDA = function(){

// 	foreach(allUtterances, function(utt){
// 		var utteranceData = subset(df_semantics, "utterance", utt)

// 		foreach(allStates, function(state){
// 			var theta = uniform(0,1)

// 			var responses = _.pluck(subset(utteranceData, "state", state), "judgment")
// 			var n_responses = responses.length
// 			var d = sum(responses)

// 			var scr = Binomial({n:n_responses, p:theta}).score(d)

// 			// var scr = sum(map(function(d){return bernoulliERP.score([theta],d==1)}, responses))
// 			// var scr = sum(map(function(d){return bernoulliERP.score([theta],d==1)}, responses))

// 			factor(scr)

// 			query.add([utt, state], theta)

// 		})
// 	})

// 	return query
// }


var semanticsBDA = function(utt,state, d, n){

	var p = uniform(0,1)

	var scr = Binomial({n:n, p:p}).score(d)

	factor(scr)

	return p
}

